

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>U O M</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <script>
        window.LoanFactoryAbi = [
          {
            "constant": false,
            "inputs": [
              {
                "name": "amount",
                "type": "uint256"
              },
              {
                "name": "interest",
                "type": "uint256"
              }
            ],
            "name": "createLoan",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "anonymous": false,
            "inputs": [
              {
                "indexed": true,
                "name": "loan",
                "type": "address"
              },
              {
                "indexed": true,
                "name": "amount",
                "type": "uint256"
              },
              {
                "indexed": true,
                "name": "interest",
                "type": "uint256"
              },
              {
                "indexed": false,
                "name": "borrower",
                "type": "address"
              }
            ],
            "name": "NewLoan",
            "type": "event"
          },
          {
            "constant": true,
            "inputs": [
              {
                "name": "",
                "type": "uint256"
              }
            ],
            "name": "loans",
            "outputs": [
              {
                "name": "",
                "type": "address"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          }
        ];
        window.LoanContractAbi = [
        {
          "constant": false,
          "inputs": [],
          "name": "payBack",
          "outputs": [],
          "payable": true,
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "constant": false,
          "inputs": [],
          "name": "lend",
          "outputs": [],
          "payable": true,
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "inputs": [
            {
              "name": "_amount",
              "type": "uint256"
            },
            {
              "name": "_interest",
              "type": "uint256"
            },
            {
              "name": "_borrower",
              "type": "address"
            }
          ],
          "payable": false,
          "stateMutability": "nonpayable",
          "type": "constructor"
        }
      ];
      </script>
  </head>
  <body>
     <section class="hero">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">
        Refurbishing of Ackerstraße 29
      </h1>
      <h2 class="subtitle">
         This page is for <strong>Lenders</strong>!</br>
        Put your Ethereums to work: you will support this project and get your capital+ a fixed interest rate back in 1 year time.
      </h2>
    </div>
  </div>
  <div class="box">
  <article class="media">
    <div class="media-left">
      <figure class="image is-64x64">
        <img src="file:///Users/alessiotixi/Documents/GitHub/realchain/Screen%20Shot%202018-04-07%20at%2013.24.39.png">
      </figure>
    </div>
    <div class="media-content">
      <div class="content">
        <p>
          <strong>Ackerstraße 29</strong> <small>@tiji</small> <small>6 Apr 2018</small>
          <br>
          Occupy Ackerstraße- finance our project and help us turn this place into a zoo!
        </p>
      </div>
      <nav class="level is-mobile">
        <div class="level-left">
          <a class="level-item">
            <span class="icon is-small"><i class="fas fa-reply"></i></span>
          </a>
          <a class="level-item">
            <span class="icon is-small"><i class="fas fa-retweet"></i></span>
          </a>
          <a class="level-item">
            <span class="icon is-small"><i class="fas fa-heart"></i></span>
          </a>
        </div>
      </nav>
    </div>
  </article>
</div>
</section>
  <div class="container">

    <p class="subtitle">
        Details of the IOU note
        <p>
         <nav class="level">
   <div class="level-item has-text-centered">
    <div>
      <p class="heading">Issued</p>
      <p class="title">6 Apr 2018</p>
    </div>
    <div class="level-item has-text-centered">
    <div>
      <p class="heading">Borrower</p>
      <p class="title"><a href="https://etherscan.io/tx/0xae5c94269071994cfb1f5dcdc1af310782b3861ad795638247513bf202d4bb9e" title="Etherscan">0xae...</a></p>
    </div>
  </div>
  <div class="level-item has-text-centered">
    <div>
      <p class="heading">Contract</p>
      <p class="title"><a href="https://etherscan.io/address/0x653cd961ed568b49dfd86048cf54cce163edb780" title="Etherscan">0x65...</a></p>
    </div>
  </div>
  <div class="level-item has-text-centered">
    <div>
      <p class="heading">Amount sought</p>
      <p class="title">10 ETH</p>
    </div>
  </div>
  <div class="level-item has-text-centered">
    <div>
      <p class="heading">Interest to pay</p>
      <p class="title"> 10%</p>
    </div>
  </nav>
   <div class="row">
      <progress class="progress is-success" value="60" max="100">60%</progress>
</div>
      <div class="control">
</div>
</div>
</div>
</nav>
</p>
</p>
</div>
</br>
</br>
<section>
  <div class="container">
    <h1 class="title"> Esisting pledges </h1>
 <table class="table">
  <thead>
    <tr>
      <th><abbr title="Date of pledge">Date</abbr></th>
      <th>Tx Hash</th>
      <th>Block</th>
      <th><abbr title="Lender's address">Lender</abbr></th>
      <th><abbr title="Amount lent">Amount</abbr></th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>7 Apr 2018</td>
       <td><a href="https://etherscan.io/tx/0xae5c94269071994cfb1f5dcdc1af310782b3861ad795638247513bf202d4bb9e" title="Etherscan">0xae...</a></td>
       <td><a href="https://etherscan.io/block/5396714" title="Etherscan">Block</a></td>
      <td><a href="https://etherscan.io/tx/0xae5c94269071994cfb1f5dcdc1af310782b3861ad795638247513bf202d4bb9e" title="Etherscan">0xae...</a></td>
      <td>2 Eth</td>
      <td> Note is Live! </td>
    </tr>
  </tbody>
</table>
</div>
</section>
 <section class="container">

 <div class="columns">
 <div class="control, column">
  <input id="pledge-input" class="input is-focused" type="text" placeholder="e.g. 1 Ether">
</div>
  <div class="column">
    <a id="pledge-button" class="button is-warning">Pledge now!</a>
  </div>
  <div class="column">

  </div>
  <div class="column">
  </div>
</div>
  </section>
  <script>
    const $pledgeInput = document.querySelector('#pledge-input');
    const $pledgeButton = document.querySelector('#pledge-button');

    const params = window.location.search.replace('?', '').split('&').reduce((acc, arg) => ({...acc, [arg.split('=')[0]]: arg.split('=')[1] }), {})
    const loanFactoryContract = web3.eth.contract(window.LoanContractAbi).at(params.contract);

    $pledgeButton.addEventListener('click', () => {
      web3.eth.getAccounts((err, [address]) => {
        loanFactoryContract.lend({ value: web3.toWei(parseFloat($pledgeInput.value)), from: address }, (e, data) => {
          console.log('pledge', e, data);
          alert(data);
        })

      });
    });

  </script>
  </body>
</html>
